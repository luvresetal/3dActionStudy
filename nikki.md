制作日記  
ここでは作っていて思ったこと気になったことやつまづいたこととかを書いていってます。  
深夜に書いててテンションおかしかったり、全然わからなくてイライラしてたり。    
情けないことしか書いてないです。     
あくまで個人用に。今後の勉強に役立てるために書いてます。  
  
7月23日  
戦闘時に敵をロックオンできるようにする。  
まず、トレースで敵を検知することから。  
https://docs.unrealengine.com/4.26/ja/InteractiveExperiences/Tracing/HowTo/SingleLineTraceByChannel/  
↑を参考に、SphereTraceByChannelをつかってみたら、床しか検知しない。敵どころか壁とか障害物とかも検知しない。  
んで、今度はSphereTraceByObjectでやってみると、ObjectTypesという配列がないとコンパイルが通らない。  
https://shuntaendo.hatenablog.com/entry/2016/03/04/004331  
ObjectTypesというのはpawnとかactorとかオブジェクトの種類をノードに指定したいときに使うものみたい。  
トレースしたいオブジェクトを指定したいというのは当然だなって。  
で、指定したいのが2種類以上あるっていうもの。  
SphereTraceByObjectに渡すのはObjectTypesの配列。  
そういえば、UnrealEngineで配列の扱い方って？？？だなぁ。  
https://docs.unrealengine.com/4.26/ja/ProgrammingAndScripting/Blueprints/BP_HowTo/WorkingWithArrays/  
公式ドキュメントに説明があったので書いとく。  
今回は一度宣言したらいじらないのでまずはいいとして、いじる時がなぁ。。。  
ブループリントでループ文とか使うのはとっつきづらそう(コード書くのとはやり方がガラッと変わりそう)・・・  
ロックオンといえば、元のゲームはキーを押してる時だけロックオンしてた。  
んで、気になったのは「キー/ボタンが押しっぱなし」ってブループリントではどうやるのか。  
http://kagring.blog.fc2.com/blog-entry-335.html  
調べたらないそうで、「えっ」となる。  
確か、Unityは押しっぱなしの時の関数ってあったはずなのにー

  
7月21日  
とりあえず、動きなしでポーズだけのアニメーションシーケンスを作ることができた。  
ボーンの角度とかを変えてポーズを作り、「アセットを作成」で出力してあげれば作れた。  
![Glide](https://user-images.githubusercontent.com/10493658/126737390-bb03aace-e786-48df-9560-082f878fa6f9.PNG)
ただ、1度出力したアセットを修正する方法が分かってないので微調整すると新規でアセットができてしまう。  
ポーズ作りは割と簡単だったりするので、欲が出て調整したくなってきたときにどんどんアセットが作られてしまうのはなぁ。  
このあとは、歩きとしゃがみ移動を作っていく予定・・・。  
歩きとしゃがみ移動できた！  
https://docs.unrealengine.com/4.26/ja/AnimatingObjects/SkeletalMeshAnimation/Blendspaces/Editor/  
ブレンドスペースを使ったらめっちゃ簡単にできた！  
プログラムで速度を調整することで止まり、歩き、走りの切り替えができるアニメーションが簡単に！  
  
あと、一応アニメーションは作れたので、魂の吸収モーション作って組み込んどいた。  
  
7月20日  
しゃがみハイジャンプができたので、滑空を作ろうと思う。  
せっかくだからアニメーションシーケンスを作ってみようとしてみたが、、、  
![why](https://user-images.githubusercontent.com/10493658/126270653-563c238a-5d41-4393-b497-ee8e5a54e6e3.PNG)  
公式ドキュメントの画面と違う！しかも一番重要なウインドウ！  
https://docs.unrealengine.com/4.26/ja/AnimatingObjects/SkeletalMeshAnimation/Persona/Modes/Animation/  
で、公式ドキュメントで説明されてるシーケンスエディタってどうすればでてくるの？
公式ドキュメントはバージョン4.16とあるけど、自分が使ってるバージョン4.26では変わったとか！？  
スクショの赤枠部分のウインドウが何者なのかもわからない。  
アニメーションシーケンスじゃなくてスケルトンのほうをいじったらアニメーションシーケンスができたけど  
結局スクショの謎ウインドウはわからずじまい。これのせいで3時間、頭抱えてしまった。  

7月19日  
まずはしゃがみモーションを組み込んでみる。  
アニメーションのリターゲットができたので、アニメーションブループリントに組み込んで、キャラのブループリントと連携して。。。  
一通り作って実行してみたらアニメーションがつながってくれない。  
アニメーションブループリントにブレークポイントをはっても止まってくれず、  
「アニメーションブループリントにブレークポイントって効かないの！？」とパニックに。  
キャラのブループリントに指定するアニメーションブループリントが間違ってたのが原因だったけど。  
アニメーションブループリントのデバッグについて調べてたらデバッグウインドウのことが出てきた。  
https://docs.unrealengine.com/4.26/ja/AnimatingObjects/SkeletalMeshAnimation/Persona/Debug/  
今後使えるかもなことなのでメモ。
  
これで動いたのだけれど、アニメーションの位置がおかしい。  
![crouch1](https://user-images.githubusercontent.com/10493658/126182034-8c074f73-5f3b-41d7-bedb-12f740811564.png)
リターゲットのときに位置がおかしくなってしまっているっぽい。  
あれこれ調べていじってたらできた。スケルトンのボーンのリターゲット設定を変えてやればいけるっぽい。  
https://docs.unrealengine.com/4.26/ja/AnimatingObjects/SkeletalMeshAnimation/AnimationRetargeting/  
これもぱっと見で設定表示が出てきてないので混乱したなぁ…。  
  
7月16日    
プレイヤーの動きに関してマーケットプレイスを探したらいいのが見つかったので使ってみようとする。   　
https://www.unrealengine.com/marketplace/ja/item/7001dd4a4fd04aaaaf189801c5ce7ee6  
・・・が、今まで使ってたマネキンにスターターパックのアニメーションが使えない。  
調べてみると「リターゲット」という作業が必要とのこと。  
やり方を調べても自分的にわかる情報が見つからず、またもや詰まってムキーっとイラつく。  
いろいろ探して自分的に一番わかりやすかったのが、Epicの公式ドキュメントだった。  
https://docs.unrealengine.com/4.26/ja/AnimatingObjects/SkeletalMeshAnimation/AnimHowTo/Retargeting/  
要はアニメーションをプロジェクトで使ってるスケルトンに合わせて作り直す感じなのかな？  
Epicの公式ドキュメントってわかりずらい印象あって敬遠してたから見落としてた。  

7月12日  
プレイヤーの操作まわりをいじっていく。  
自分はちょいちょい実行して動作を確認しながら作っていく性質で、  
組んだはいいけどひとまずコメントアウトして保留しておきたいときがあって、ブループリントでもそんなことできないかな、  
と探したら、隠れ機能っぽい。  
https://unrealengine.hatenablog.com/entry/2016/04/09/120000   
ブループリントではコメントアウトってあまり使われないのかな？  

プレイヤーまわり作っていくときに避けては通れなさそうなのが、キャラクターのモーション。  
こういうのってデザイナーさんに作ってもらうものでプログラマーでやってきた自分には全く技術がないんだよなぁ。  
どうしたものか・・・・今からでもアセットストアで素材を探すか・・・    

7月11日  
SpawnActorで出したアクタがAIコントローラーのEventBeginPlay通ってない   
ノードにカーソルあわせると出る説明にはゲームのプレイが始まった時って書かれてるからゲームの途中でスポーンされたときは通らないのか・・  
・・・というわけではなくて、アクタのブループリントのAuto Possess AIの設定を変えてあげればいいのか。
で通ったけどやっぱり動かない（よくわからない余計な処理書いてたからだった）  
  
これで戦闘の流れはできたはず。次はプレイヤーの動きを作っていこうかな。まだまだテンプレートの内容のままだから。

7月10日  
プレイヤーの体力回復の処理を作っている。
ダメージの受け渡しはApply Damageで送ってEvent Any Damage受けとるってやるのだけれど、回復はそうはいかないらしい。  
当たり判定が作動したら、みたいな感じでやるらしい。  
ダメージも回復も似たようにできるのだから同じノードで出来たらなぁと思ったり。
当たり判定にしてもアイテムとプレイヤーのどっちでやったら実装しやすいのかとかも考えないとなぁ。  
最初アイテム側で実装しようとしてややこしいことになってしまった。  

パラメータは回復できたけど、ゲージ（UI）は回復してない！なんでだ。  
・・・と思って調べたら回復したよってことをUI側のブループリントに伝えてなかったからだった。  
ちょっと前に作った関数とかを忘れるなんて。  

7月8日  
周期的に来る不調がなかなか終わらない。これのせいで勉強が全然はかどらない。   
  
ビヘイビアツリーのタスクとサービスの違いが分からない  
各ブループリント間での変数とかの参照の方法がいまいちピンとこない
ブループリント内の変数のスコープ範囲が分からない。基本、全部グローバル変数？  

7月7日  
【バカにされるだろうけど、さらしてみる】  
ふらふら飛ぶ光の玉を作る。  
今後の実装のこと考えて、ブループリントで動きを作る。  
ほんとはもっとふよふよとした浮遊感を出したかった。  
ブループリント触ってて、「このやり方で合ってるかなぁ？」と思い不安になる。  
（仕事でコード書いてて同じ不安になることがしょっちゅうあったりする）  
実際、LeapノードやEaseノードがあるのを知らずに、必死こいて移動させるための線形補完処理をブループリントで組んでたり・・・。  
てか、線形補完というものをはじめて知りました…。大学で習ったっけ？覚えてない…？まともに授業受けてなかった？あれー？  
とりあえず、会社で恥をかかなくて済んだということで。  
しかし、昔のプログラマーはこういうのをコードで書いてたをの考えると本当に頭が下がる…。今回の実装だって元のゲームの動きとは違うしなぁ…。  
願いが叶うなら、ソースコードを見てみたい・・・。  
  
やっぱりビヘイビアツリー関連でつまづく・・・  
もう寝る！  

6月30日  
【バカにされるだろうけど、さらしてみる】  
敵の体力を一定以下にして気絶状態にした後、しばらくすると復帰してまた襲ってくるようにしてみました。  
調べた感じ、UnrealEngine４のタイマー設定の仕方にはいろいろあるみたいですが、自分なりにこういう感じかなぁ？で組んでみました。（C++とかでも簡単に書けるはず？）  
なんとなく、参考にしてるゲームの処理と違うなぁ。  
いくら目コピとはいえ、、、  
変だったらツッコんでください…。  
あと、デバッグ用にプレイヤーがダメージを食らわないフラグを組み込みました。  
普通にゲームやってるとズルでしかないけど、デバッグ中は無いと煩わしい・・・。  
![206079621_5714910055250606_2464043641148946998_n](https://user-images.githubusercontent.com/10493658/124921282-314cc200-e033-11eb-8511-3f45f32367b7.jpg)

6月29日  
ブループリント触ってるとこの先コードが書けるか不安になってくる。  
今作ってるものをC++とかDirectXとかで作れとか言われたら絶対出来ないし…  

6月28日  
【バカにされるだろうけど、さらしてみる】
ビヘイビアツリーにばかり気になって調べてたけど、UnrealEngineにおけるAIの作り方で調べたらビヘイビアツリーのいじり方とかでてきてやっと理解できた。  
わかってしまえばこっちのものなので、あとは組んでいくだけ。  
割とサクサク組めた。  
体力値が一定以下でその場で何もしなくなり（気絶状態）、  
気絶状態中プレイヤーの特殊攻撃を食らうことでやられるという風に。  
分かりやすくするために適当に作ったパーティクルをつけてみたり。  
プログラマが作った仮素材ということで…。  
参考になったサイト様    
https://hahanha-create.com/2020/01/11/%e3%80%90ue4-ai%e5%85%a5%e9%96%80%e3%80%91%e7%b0%a1%e5%8d%98%e3%81%aanpc%e3%81%ae%e4%bd%9c%e6%88%90%e3%81%8b%e3%82%89%e5%ad%a6%e3%81%b6ue4%e3%81%aeai/  

6月24日  
【バカにされるだろうけど、さらしてみる】  
【頭がこんがらがってきたので整理したい】  
UnrealEngineで敵の動きを作りたくてビヘイビアツリーというものを触る。  
ネットの情報で概要みたいなのはわかったけれど、詳細な使い方みたいなのは見つからず、頭の中で出来上がっている処理の流れをビヘイビアツリーに落とし込むことができず。  
自分のほうではやりたいことがはっきりしてるのに、PC/UnrealEngineがいうこと聞いてくれないみたいになってて結構イライラしてきます。  
普通にコード書いてたらこんなことにはならないハズなのに、っていう感じにもなるので余計イライラ。  
敵がプレイヤーに近寄ってきたり、近くに来たら殴って攻撃する、ということはできているので次は、敵がダメージを受けてHPが一定値まで下がったら動きを止めるというのをやりたい。  
動きを止めるだけならstop logicノードでビヘイビアツリー自体を停止すればばいいのだけれど、今後敵のバリエーションでHPが一定値以下なら逃げ出す、というものを作ろうとしたときにstop logicノードを使う方法はできないわけで。。。  
ビヘイビアツリーで条件分岐の判定に使うデコレーターというものをカスタムしたいのだけど、作り方みたいなのがネットで探しても出てこない！！！
明日、梅田の紀伊国屋書店でも行って本探してこようかな…。  


6月23日  
ビヘイビアツリーってなんなんだよ  
Unreal engine さわっててイラついてきたので寝る！  

6月22日  
【バカにされるだろうけど、さらしてみる】  
うずまき型の体力ゲージ、できました。  
減り方のバランスが変なのはGimpでグラデーション画像作った時にしくじったのが原因なので後で作り直さないと。  
関係ないけど、ゲージの絵見てると蚊取り線香ほしくなります。  
これでゲーム画面のHUDはひとまずおわりで、次は敵のやられた処理を作りこんでいこうかな。  

6月21日  
【バカにされるだろうけど、さらしてみる】
さすがに4日もさぼってしまったので、勉強再開。  
夜のほうが涼しくて勉強しやすいのでついつい夜更かしになってしまいます。体壊さないようにしないと…。  
ブループリント書いてて処理が複雑になってくるとノードの流れが横にびろーーーんと伸びてくるとなんだか不安になります。  
あと、流れの途中にノードを追加すると、見た目がごちゃごちゃになりそうなので、いちいちなるべくきれいに整えるのが地味にめんどくさい！  
![200579998_5642840919124187_4457994650732533421_n](https://user-images.githubusercontent.com/10493658/124919871-acad7400-e031-11eb-9869-18dc3f103aa2.jpg)


6月15日
【バカにされるだろうけどさらしてみる】  
近頃、ゲームを遊びたい気持ちよりゲームを作りたい気持ちが勝ってるのでUnrealEngineの勉強します。  
ゲームの土台っぽいのはできたと思うのでUIを作っていこうかと。  
成果物としての目標は推しゲームのクローンを作ることなので、UIも似た感じのものを作ることに。とはいっても体力ゲージだけなんですが。  
ただ、形がくせ者でうずまき型の体力ゲージなんですよ。  
土台、ゲージ、マスクと3つの画像を作って、ネットに上がっていた円形ゲージの作り方を参考にBlueprintを組んでいったら行けそうな感じになりました。  
。。。画像を作るのにGimpとにらめっこでした。特にマスク画像を作るのが。今でもゲージの進み方が変なので作り直さないと。  
UnrealEngineはこういうプログラムとは関係ないところで詰まることが多いです。Unityで開発してた時はただただコード書いてるだけでモノができちゃってたのでうーーーーーんとなってます。  
![200579998_5642840919124187_4457994650732533421_n](https://user-images.githubusercontent.com/10493658/124919668-72dc6d80-e031-11eb-9dee-2158fb65af4f.jpg)

6月11日  
【バカにされるだろうけどさらしてみる】  
昨日はプレイヤーから敵への攻撃処理だったので、今日は敵からプレイヤーへの攻撃処理。  
やってることは今まで作ってきたことをいじるだけなので、すんなりいけました。  
ただ、昨日今日で引っかかったことがありまして、ブループリントで四則計算や等式不等式のノードのつなぎ方が混乱しました。  
コード書くときは「ｚ＝ｘ＋y」みたいに普通に計算式書く感じで行けたのに、ブループリントだとこうはいかないのでピンのさす位置を何度も間違えて実行結果が思うように出なくて、原因探すのに時間とられました。  
今でも混乱するので、EpicGamesに文句言いたい・・・。  
  
6月10日  
【バカにされるだろうけどさらしてみる】  
気分がしんどくなる時期を抜けたみたいなので、上向き調子に乗ってUnrealEngineのゲーム開発をする。  
格闘すること4，5時間かかってプレイヤーの攻撃処理、敵のダメージ処理を実装しました。  
敵がダメージ食らったときに火花散らしてみたけど、やられたときの爆発が出てないので後々修正します。  
しょうもないレベルのことですが、自分の力でできたのでなんかうれしい気分です。  
さー次は敵の攻撃処理だ  

6月6日  
【モチベーション上げたいのでさらします】  
勉強しなくちゃと思ってUnrealEngine立ち上げたはいいものの、気持ちがずーーーーーーーーーんと沈みすぎててやる気が出ない…  
あとやるべきことがたくさんありすぎて、頭の中で収集がつかなくなっているのかも。  
（これはノートに書きだして、やることに順番つければ行けるはず）  
それと、プレイヤーも敵もモーションがいいやつがあればモチベーションも上がると思うんだけどなぁ…  
  
5月28日  
【バカにされるだろうけど、さらしてみる】　　  
【勉強としてやっていることの記録】　　  
アンリアルクエスト1日目の初級、中級課題に挑戦してみてそれっぽいのができたので、勉強用プロジェクトに組み込んでみた。　　  
UnrealEngine4は何度も挫折を繰り返していたけれど、アンリアルクエスト1日目の課題は割とすんなり解けた（ジップラインだけ詰まった）ので今までやってきたことは無駄じゃなかったんだなぁ、とちょっとうれしくなりました。　　  
